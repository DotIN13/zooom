var w=Object.defineProperty;var M=(e,t,s)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var l=(e,t,s)=>(M(e,typeof t!="symbol"?t+"":t,s),s);function E(e){return e.replace(/(?:[_-])([a-z0-9])/g,(t,s)=>s.toUpperCase())}function k(e){return E(e.replace(/--/g,"-").replace(/__/g,"_"))}function f(e){return e.charAt(0).toUpperCase()+e.slice(1)}function B(e){return e.replace(/([A-Z])/g,(t,s)=>`-${s.toLowerCase()}`)}function m(e,t){let s=O(e);return Array.from(s.reduce((r,i)=>(F(i,t).forEach(n=>r.add(n)),r),new Set))}function T(e,t){return O(e).reduce((r,i)=>(r.push(...C(i,t)),r),[])}function O(e){let t=[];for(;e;)t.push(e),e=Object.getPrototypeOf(e);return t.reverse()}function F(e,t){let s=e[t];return Array.isArray(s)?s:[]}function C(e,t){let s=e[t];return s?Object.keys(s).map(r=>[r,s[r]]):[]}var Y=(()=>typeof Object.getOwnPropertySymbols=="function"?e=>[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)]:Object.getOwnPropertyNames)(),J=(()=>{function e(s){function r(){return Reflect.construct(s,arguments,new.target)}return r.prototype=Object.create(s.prototype,{constructor:{value:r}}),Reflect.setPrototypeOf(r,s),r}function t(){let r=e(function(){this.a.call(this)});return r.prototype.a=function(){},new r}try{return t(),e}catch{return r=>class extends r{}}})();var Z={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:e=>`data-${e}-target`,outletAttributeForScope:(e,t)=>`data-${e}-${t}-outlet`,keyMappings:Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End"},y("abcdefghijklmnopqrstuvwxyz".split("").map(e=>[e,e]))),y("0123456789".split("").map(e=>[e,e])))};function y(e){return e.reduce((t,[s,r])=>Object.assign(Object.assign({},t),{[s]:r}),{})}function $(e){return m(e,"classes").reduce((s,r)=>Object.assign(s,D(r)),{})}function D(e){return{[`${e}Class`]:{get(){let{classes:t}=this;if(t.has(e))return t.get(e);{let s=t.getAttributeName(e);throw new Error(`Missing attribute "${s}"`)}}},[`${e}Classes`]:{get(){return this.classes.getAll(e)}},[`has${f(e)}Class`]:{get(){return this.classes.has(e)}}}}function N(e){return m(e,"outlets").reduce((s,r)=>Object.assign(s,x(r)),{})}function x(e){let t=k(e);return{[`${t}Outlet`]:{get(){let s=this.outlets.find(e);if(s){let r=this.application.getControllerForElementAndIdentifier(s,e);if(r)return r;throw new Error(`Missing "data-controller=${e}" attribute on outlet element for "${this.identifier}" controller`)}throw new Error(`Missing outlet element "${e}" for "${this.identifier}" controller`)}},[`${t}Outlets`]:{get(){let s=this.outlets.findAll(e);return s.length>0?s.map(r=>{let i=this.application.getControllerForElementAndIdentifier(r,e);if(i)return i;console.warn(`The provided outlet element is missing the outlet controller "${e}" for "${this.identifier}"`,r)}).filter(r=>r):[]}},[`${t}OutletElement`]:{get(){let s=this.outlets.find(e);if(s)return s;throw new Error(`Missing outlet element "${e}" for "${this.identifier}" controller`)}},[`${t}OutletElements`]:{get(){return this.outlets.findAll(e)}},[`has${f(t)}Outlet`]:{get(){return this.outlets.has(e)}}}}function S(e){return m(e,"targets").reduce((s,r)=>Object.assign(s,L(r)),{})}function L(e){return{[`${e}Target`]:{get(){let t=this.targets.find(e);if(t)return t;throw new Error(`Missing target element "${e}" for "${this.identifier}" controller`)}},[`${e}Targets`]:{get(){return this.targets.findAll(e)}},[`has${f(e)}Target`]:{get(){return this.targets.has(e)}}}}function V(e){let t=T(e,"values"),s={valueDescriptorMap:{get(){return t.reduce((r,i)=>{let n=A(i,this.identifier),c=this.data.getAttributeNameForKey(n.key);return Object.assign(r,{[c]:n})},{})}}};return t.reduce((r,i)=>Object.assign(r,j(i)),s)}function j(e,t){let s=A(e,t),{key:r,name:i,reader:n,writer:c}=s;return{[i]:{get(){let a=this.data.get(r);return a!==null?n(a):s.defaultValue},set(a){a===void 0?this.data.delete(r):this.data.set(r,c(a))}},[`has${f(i)}`]:{get(){return this.data.has(r)||s.hasCustomDefaultValue}}}}function A([e,t],s){return P({controller:s,token:e,typeDefinition:t})}function p(e){switch(e){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function h(e){switch(typeof e){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(e))return"array";if(Object.prototype.toString.call(e)==="[object Object]")return"object"}function K(e){let t=p(e.typeObject.type);if(!t)return;let s=h(e.typeObject.default);if(t!==s){let r=e.controller?`${e.controller}.${e.token}`:e.token;throw new Error(`The specified default value for the Stimulus Value "${r}" must match the defined type "${t}". The provided default value of "${e.typeObject.default}" is of type "${s}".`)}return t}function I(e){let t=K({controller:e.controller,token:e.token,typeObject:e.typeDefinition}),s=h(e.typeDefinition),r=p(e.typeDefinition),i=t||s||r;if(i)return i;let n=e.controller?`${e.controller}.${e.typeDefinition}`:e.token;throw new Error(`Unknown value type "${n}" for "${e.token}" value`)}function R(e){let t=p(e);if(t)return z[t];let s=e.default;return s!==void 0?s:e}function P(e){let t=`${B(e.token)}-value`,s=I(e);return{type:s,key:t,name:E(t),get defaultValue(){return R(e.typeDefinition)},get hasCustomDefaultValue(){return h(e.typeDefinition)!==void 0},reader:U[s],writer:b[s]||b.default}}var z={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},U={array(e){let t=JSON.parse(e);if(!Array.isArray(t))throw new TypeError(`expected value of type "array" but instead got value "${e}" of type "${h(t)}"`);return t},boolean(e){return!(e=="0"||String(e).toLowerCase()=="false")},number(e){return Number(e)},object(e){let t=JSON.parse(e);if(t===null||typeof t!="object"||Array.isArray(t))throw new TypeError(`expected value of type "object" but instead got value "${e}" of type "${h(t)}"`);return t},string(e){return e}},b={default:_,array:v,object:v};function v(e){return JSON.stringify(e)}function _(e){return`${e}`}var o=class{constructor(t){this.context=t}static get shouldLoad(){return!0}static afterLoad(t,s){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:s=this.element,detail:r={},prefix:i=this.identifier,bubbles:n=!0,cancelable:c=!0}={}){let a=i?`${i}:${t}`:t,g=new CustomEvent(a,{detail:r,bubbles:n,cancelable:c});return s.dispatchEvent(g),g}};o.blessings=[$,S,V,N];o.targets=[];o.outlets=[];o.values={};var u=class extends o{connect(){this.idValue="portal-"+[...Array(8)].map(()=>Math.random().toString(36)[2]).join(""),this.element.id=this.idValue,this.templateTarget.content.querySelector("[data-controller]").dataset.portalId=this.idValue}open(e){let t=this.newContainer();this.newPlayer(t,e.params)}newContainer(){let e=document.createElement("div");return e.className="portal-player player-outer",Object.assign(e.dataset,this.containerDatasetValue),e}removeContainer(e){e.remove()}newPlayer(e,t){e.innerHTML=this.templateTarget.innerHTML,(document.getElementById(t.destinationId)||document.body).appendChild(e)}};l(u,"targets",["template","image"]),l(u,"values",{id:String,containerDataset:Object,containerClass:String});var d=class extends o{initialize(){this.element.dataset.zooomPortalOutlet=`#${this.element.dataset.portalId}`,this.portalImage=this.portalOutlet.imageTarget,this.portalRect=this.portalImage.getBoundingClientRect(),this.handleGesture()}scrollOut(e){if(this.zoomingOut)return;let t=e.target===document?window:e.target;this.baseScrollX||(this.baseScrollX=t.scrollX),this.baseScrollY||(this.baseScrollY=t.scrollY);let s=t.scrollX-this.baseScrollX,r=t.scrollY-this.baseScrollY;(Math.abs(s)>20||Math.abs(r)>20)&&this.zoomOut()}magnify(e){let t="scale(1.2)";this.commitStyles(this.imageTarget.style,{transform:t}),console.log(e)}handleGesture(){this.imageTarget.addEventListener("gesturestart",e=>{console.log(e)}),this.imageTarget.addEventListener("gesturechange",e=>{console.log(e)}),this.imageTarget.addEventListener("gestureend",e=>{console.log(e)})}zoomIn(){this.imageRect=this.imageTarget.getBoundingClientRect();let e=this.imageTarget.style,t=null,s=this.newTransform(this.imageRect,this.portalRect);this.commitStyles(e,{transition:t,transform:s}),window.requestAnimationFrame(()=>{let r="visible";t="transform 400ms cubic-bezier(0.4, 0, 0, 1)",s=null,this.commitStyles(e,{visibility:r,transition:t,transform:s})})}zoomOut(){if(this.zoomingOut)return;this.zoomingOut=!0;let e=this.imageTarget.style;this.imageRect=this.imageTarget.getBoundingClientRect();let{top:t,left:s,width:r,height:i}=this.imageRect,n="fixed";this.commitStyles(e,{transform:"none",transition:"none"}),window.requestAnimationFrame(()=>{this.commitStyles(e,{top:t,left:s,width:r,height:i,position:n}),window.requestAnimationFrame(()=>{this.imageTarget.addEventListener("transitionend",g=>{g.propertyName=="transform"&&(this.zoomingOut=!1,this.portalOutlet.removeContainer(this.element.closest(".portal-player")))});let c="transform 400ms cubic-bezier(0.4, 0, 0, 1)",a=this.newTransform(this.imageRect,this.portalRect);this.updateTopLeft(),this.commitStyles(e,{transition:c,transform:a})})})}updateTopLeft(){if(!this.zoomingOut)return;let e=this.portalImage.getBoundingClientRect(),{top:t,left:s}=this.imageRect,r=e.top-this.portalRect.top,i=e.left-this.portalRect.left,n=this.imageTarget.style;(r!=0||i!=0)&&this.commitStyles(n,{top:t+r,left:s+i}),window.requestAnimationFrame(this.updateTopLeft.bind(this))}newTransform(e,t){let s=t.width/e.width,r=t.height/e.height,i=t.left-e.left+(t.width-e.width)/2,n=t.top-e.top+(t.height-e.height)/2;return`translate(${i}px, ${n}px) scaleX(${s}) scaleY(${r})`}commitStyles(e,t){Object.keys(t).forEach(s=>{["top","left","bottom","right","height","width"].includes(s)&&(t[s]=`${t[s]}px`)}),Object.assign(e,t)}};l(d,"targets",["image"]),l(d,"outlets",["portal"]);export{u as PortalController,d as ZooomController};
//# sourceMappingURL=zooom.min.js.map
